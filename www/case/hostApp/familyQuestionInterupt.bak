<Cfset client.usertype = 1>
<Cfset client.email = 'josh@pokytrails.com'>
<cfset season = 9>
<cfset dirPath = "C:/websites/student-management/nsmg/">
<!--- Import CustomTag Used for Page Messages and Form Errors --->
<cfimport taglib="../extensions/customTags/gui/" prefix="gui" />	
<cfparam name="submitForm" default=0>
<cfquery name="qHostParentsMembers" datasource="mysql">
select h.fatherfirstname, h.fatherdob, h.fatherlastname, h.motherfirstname, h.motherlastname, h.motherdob, h.fatherssn, h.motherssn, h.companyid, h.regionid, h.email
from smg_hosts h
where h.hostid = #client.hostid# 
</cfquery>
<cfquery name="qHostParentsCBC" datasource="mysql">
select * 
from smg_documents
where hostid = #client.hostid#
</cfquery>

<cfquery name="checkFatherCBC" dbtype="query">
select *
from qHostParentsCBC
where shortDesc = 'Father CBC Auth'

</cfquery>
<cfquery name="checkMotherCBC" dbtype="query">
select *
from qHostParentsCBC
where shortDesc = 'Mother CBC Auth'
</cfquery>

 <cfscript>
 if ( LEN(TRIM(qHostParentsMembers.motherfirstname)) and not len(trim(qHostParentsMembers.motherdob)) )  {
                // Get all the missing items in a list
                SESSION.formErrors.Add("#qHostParentsMembers.motherfirstname# is missing her date of birth on page 1 of the application.  It is required to process this page. Please click on Name & Contact info in the menu and enter the date of birth.");
			}
			
		   if ( LEN(TRIM(qHostParentsMembers.fatherfirstname)) and not len(trim(qHostParentsMembers.fatherdob)) )  {
                // Get all the missing items in a list
                SESSION.formErrors.Add("#qHostParentsMembers.fatherfirstname# is missing her date of birth on page 1 of the application.  It is required to process this page. Please click on Name & Contact info in the menu and enter the date of birth.");
			}
              
</cfscript>
<cfif SESSION.formErrors.length()>
<gui:displayFormErrors 
        formErrors="#SESSION.formErrors.GetCollection()#"
        messageType="section"
        />
<cfabort>
</cfif>



<!--- Process Form Submission --->
    <cfif isDefined('FORM.processCBC')>
    
    	<!----Validate Father SSN, if needed---->
  		<cfif isDefined('form.fatherssn')>
    	    <cfscript>
            // Data Validation
			
			// Valid SSN
           if  ( LEN(TRIM(form.fatherssn)) NEQ 11) {
                // Get all the missing items in a list
               SESSION.formErrors.Add("The SSN for #form.fatherfirstname# does not appear to be a valid SSN. <br> Please make sure the SSN is entered in the 999-99-9999 format.");
           }	
		   if (not len(trim(form.fathersig))){
                // Get all the missing items in a list
               SESSION.formErrors.Add("The signature for #form.fatherfirstname# is missing");
           }	
		 </cfscript>
   		</cfif>	
        <!----Validate Mother ssn, if needed---->
        <cfif isDefined('form.motherssn')> 
    	    <cfscript>
            // Data Validation
			
			// Valid SSN
           if  ( LEN(TRIM(form.motherssn)) NEQ 11) {
                // Get all the missing items in a list
               SESSION.formErrors.Add("The SSN for #form.motherfirstname# does not appear to be a valid SSN. <br> Please make sure the SSN is entered in the 999-99-9999 format.");
           }	
		   if (not len(trim(form.mothersig))){
                // Get all the missing items in a list
               SESSION.formErrors.Add("The signature for #form.motherfirstname# is missing");
           }
		 </cfscript>
   		</cfif>	
        <!----check to make sure that the person should have a background check run---->
 
        
        <Cfloop list="#famList#" index="x">
        	<cfif structKeyExists(form, "#x#_ssn")>
        	
            <cfquery name="cbcCheck" datasource="mysql">
            select k.name, k.lastname, k.birthdate, k.cbc_form_received, k.childid, k.membertype, k.ssn, k.liveathome
            from smg_host_children k
            where k.childid = #x# 
            </cfquery>
            <Cfif  ( LEN(TRIM('#form[x & "_ssn"]#')) NEQ 11)>
        	<Cfif #DateDiff('yyyy',cbcCheck.birthdate,now())# gte 18 and cbcCheck.liveathome is 'yes'>
            
				<cfscript>
                    // Data Validation
                    
                    // Valid SSN
                   if  ( LEN(TRIM(#form[x & "_ssn"]#)) NEQ 11) {
                        // Get all the missing items in a list
                       SESSION.formErrors.Add("The SSN for #form[x & "_name"]# does not appear to be a valid SSN. <br> Please make sure the SSN is entered in the 999-99-9999 format.");
                   }	
                    // Valid Signature
                   if  ( NOT LEN(TRIM(#form[x & "_sig"]#))) {
                        // Get all the missing items in a list
                       SESSION.formErrors.Add("The signature for #form[x & "_name"]# is missing.");
                   }	
                
                </cfscript>
        	</Cfif>
            </Cfif>
            </Cfif>
        </Cfloop>

        <!--- Check if there are no errors --->
        <cfif NOT SESSION.formErrors.length()>
			<!--- the key for encrypting and decrypting the ssn. --->
            <cfset ssn_key = 'BB9ztVL+zrYqeWEq1UALSj4pkc4vZLyR'>
            <!----insert fathers ssn if defiend---->
            <Cfif isDefined('form.fatherssn')>
				 <cfset encfatherssn = encrypt("#trim(form.fatherssn)#", "#ssn_key#", "desede", "hex")>
                    <Cfquery name="insertFatherSSN" datasource="mysql">
                    update smg_hosts
                    set fatherSSN = '#encfatherssn#'
                    where hostid = #client.hostid#
                    </cfquery>
                      <cfif DirectoryExists('#dirPath#uploadedfiles/hosts/#client.hostid#/')>
        				<cfelse>
           				 <cfdirectory action = "create" directory = "#dirPath#uploadedfiles/hosts/#client.hostid#/" >
        				</cfif>
                    <cfdocument format="PDF" filename="#dirPath#uploadedfiles/hosts/#client.hostid#/#form.fatherSig#_cbcAuthorization.pdf" overwrite="yes">
                    <!--- form.pr_id and form.report_mode are required for the progress report in print mode.
                    form.pdf is used to not display the logo which isn't working on the PDF. --->
                    <cfset form.report_mode = 'print'>
                    <cfset form.pdf = 1>
                    <cfinclude template="completedCBCAuth.cfm">
                    <br /><Br />
                    <Cfoutput>
                    Electronically Signed<Br />
                    #form.fatherSig#<br />
                    #DateFormat(now(), 'mmm d, yyyy')# at #TimeFormat(now(), 'h:mm:ss tt')#<Br />
                    IP: #cgi.REMOTE_ADDR# 
                    </Cfoutput>
                </cfdocument>   
                <cfquery name="insertDocInfo" datasource="mysql">
                insert into smg_documents (fileName, type, dateFiled, filePath, description, shortDesc, userid, userType, hostID, seasonID)
                				values('#form.fatherSig#_cbcAuthorization.pdf', 'pdf', #now()#, 'hosts/#client.hostid#/', 'CBC Authorization for #form.fatherSig#','Father CBC Auth',#client.hostid#, 'Host Father',#client.hostID#, #season#)
                </cfquery> 
                <!----
                 <cfquery name="insertCBCInfo" datasource="mysql">
                insert into smg_hosts_cbc (hostid, familyid, cbc_type,dateCreated, dateUpdated, seasonID, date_authorized, companyid)
                			values(#client.hostid#, #x#, 'father', #now()#, #now()#, 9, #now()#, #qHostParentsMembers.companyid#) 
                </cfquery>
                ---->
                <cfquery name="cbcInfo" datasource="mysql">
                select cbcfamID 
                from smg_hosts_cbc
                where hostid = #client.hostid# and cbc_type = 'father'
                </cfquery>    
                
             </Cfif>
             
             <!----Insert mothers ssn if defined---->
             <Cfif isDefined('form.motherssn')>
				 <cfset encmotherssn = encrypt("#trim(form.motherssn)#", "#ssn_key#", "desede", "hex")>
                    <Cfquery name="insertMotherSSN" datasource="mysql">
                    update smg_hosts
                    set motherSSN = '#encmotherssn#'
                    where hostid = #client.hostid#
                    </cfquery>
                    
				
                      <cfif DirectoryExists('#dirPath#uploadedfiles/hosts/#client.hostid#/')>
        				<cfelse>
           				 <cfdirectory action = "create" directory = "#dirPath#uploadedfiles/hosts/#client.hostid#/" >
        				</cfif>
                    <cfdocument format="PDF" filename="#dirPath#uploadedfiles/hosts/#client.hostid#/#form.motherSig#_cbcAuthorization.pdf" overwrite="yes">
                    <!--- form.pr_id and form.report_mode are required for the progress report in print mode.
                    form.pdf is used to not display the logo which isn't working on the PDF. --->
                    <cfset form.report_mode = 'print'>
                    <cfset form.pdf = 1>
                    <cfinclude template="completedCBCAuth.cfm">
                    <br /><Br />
                    <Cfoutput>
                    Electronically Signed<Br />
                    #form.motherSig#<br />
                    #DateFormat(now(), 'mmm d, yyyy')# at #TimeFormat(now(), 'h:mm:ss tt')#<Br />
                    IP: #cgi.REMOTE_ADDR# 
                    </Cfoutput>
                </cfdocument> 
                <cfquery name="insertDocInfo" datasource="mysql">
                insert into smg_documents (fileName, type, dateFiled, filePath, description, shortDesc, userid, usertype, hostID, seasonID)
                				values('#form.motherSig#_cbcAuthorization.pdf', 'pdf', #now()#, 'hosts/#client.hostid#/', 'CBC Authorization for #form.motherSig#','Mother CBC Auth',#client.hostid#,'Host Mother',#client.hostid#, #season#)
                </cfquery> 
                <!----
                  <cfquery name="insertCBCInfo" datasource="mysql">
                insert into smg_hosts_cbc (hostid, familyid, cbc_type,dateCreated, dateUpdated, seasonID, date_authorized, companyid)
                			values(#client.hostid#, #x#, 'mother', #now()#, #now()#, 9, #now()#, #qHostParentsMembers.companyid#) 
                </cfquery>
				---->
             </Cfif>
              <Cfloop list="#famList#" index="x">
              <cfif structKeyExists(form, "#x#_ssn")>
               <cfquery name="cbcCheck" datasource="mysql">
                select k.name, k.lastname, k.birthdate, k.cbc_form_received, k.childid, k.membertype, k.ssn, k.liveathome
                from smg_host_children k
                where k.childid = #x# 
                </cfquery>
        			<Cfif #DateDiff('yyyy',cbcCheck.birthdate,now())# gte 18 and cbcCheck.liveathome is 'yes'>
            
					 <cfset encssn = encrypt("#trim(form[x & "_ssn"])#", "#ssn_key#", "desede", "hex")>
                        <Cfquery name="insertkidsssn" datasource="mysql">
                        update smg_host_children
                        set ssn = '#encssn#'
                        where childid = #x#
                        </cfquery>
                     </Cfif>
                      
                      <cfif DirectoryExists('#dirPath#uploadedfiles/hosts/#client.hostid#/')>
        				<cfelse>
           				 <cfdirectory action = "create" directory = "#dirPath#uploadedfiles/hosts/#client.hostid#/" >
        				</cfif>
                    <cfdocument format="PDF" filename="#dirPath#uploadedfiles/hosts/#client.hostid#/#form[x & "_sig"]#_cbcAuthorization.pdf" overwrite="yes">
                    <!--- form.pr_id and form.report_mode are required for the progress report in print mode.
                    form.pdf is used to not display the logo which isn't working on the PDF. --->
                    <cfset form.report_mode = 'print'>
                    <cfset form.pdf = 1>
                    <Cfset form.childid = #x#>
                    
                    <cfinclude template="completedCBCAuth.cfm">
                    <br /><Br />
                    <Cfoutput>
                    Electronically Signed<Br />
                    #form[x & "_sig"]#<br />
                    #DateFormat(now(), 'mmm d, yyyy')# at #TimeFormat(now(), 'h:mm:ss tt')#<Br />
                    IP: #cgi.REMOTE_ADDR# 
                    </Cfoutput>
                </cfdocument> 
                 <cfquery name="insertDocInfo" datasource="mysql">
                insert into smg_documents (fileName, type, dateFiled, filePath, description, shortDesc, userid, usertype, hostID, seasonid)
                				values('#form[x & "_sig"]#_cbcAuthorization.pdf', 'pdf', #now()#, 'hosts/#client.hostid#/', 'CBC Authorization for family member #form[x & "_sig"]#','Member CBC Auth', #x#, 'Fam Member',#client.hostid#, #season#)
                </cfquery> 
                <!----
                <cfquery name="insertCBCInfo" datasource="mysql">
                insert into smg_hosts_cbc (hostid, familyid, cbc_type,dateCreated, dateUpdated, seasonID, date_authorized, companyid)
                			values(#client.hostid#, #x#, 'member', #now()#, #now()#, 9, #now()#, #qHostParentsMembers.companyid#) 
                </cfquery>
				---->
                </cfif>
              	</Cfloop>
              <!----Udpate Lead Table that Application is in process---->
            <cfquery datasource="mysql">
            update smg_host_lead 
            set statusID = 8
            where email = '#client.hostemail#'
            </cfquery>
            
           
            
 <!----Get all cbc's and email them to host.  Notify the PM and Facilitator that CBC's are ready to review.---->
            <Cfquery name="getCBCs" datasource="mysql">
            select *
            from smg_documents
            where hostid = #client.hostid#
            </Cfquery>
            
             <cfsavecontent variable="hostCBCEmailMessage">
              <Cfoutput>	
              
                Attached are copies of the Criminal Background Check Authorization you and any members of your family have electronically signed.  
                <br /><br />
                Regards-<Br />
                CASE Support
              </Cfoutput>
                </cfsavecontent>

            <cfinvoke component="cfc.email" method="send_mail">
                
                       
                    <cfinvokeargument name="email_to" value="josh@pokytrails.com">        
					<!----
					<cfinvokeargument name="email_to" value="#qHostParentsMembers.email#">
                    <cfinvokeargument name="email_to" value="gary@iseusa.com"> 
					---->
                    <cfinvokeargument name="email_from" value="hostApp@iseusa.com">
                    <cfinvokeargument name="email_subject" value="CBC Authorization Forms">
                    <cfinvokeargument name="email_message" value="#hostCBCEmailMessage#">
                    
                    <cfloop query="getCBCs">
                   		<cfif getCBCs.currentrow eq 1>
                            <cfinvokeargument name="email_file" value="#dirPath#uploadedfiles/#filePath##fileName#">
                        <cfelse>
                            <cfinvokeargument name="email_file#currentrow#" value="#dirPath#uploadedfiles/#filePath##fileName#">
                        </cfif>
                   </cfloop>
				
                </cfinvoke>	
          <!---Facilitator and Program Manager Email---->
          
          
        <cfquery name="programManager" datasource="mysql">
        select pm_email
        from smg_companies
        where companyid = #qHostParentsMembers.companyid#
        </cfquery>
        <cfquery name="facilitator" datasource="mysql">
        select uar.userid, u.email
        from user_access_rights uar
        left join smg_users u on u.userid = uar.userid
        where regionid = #qHostParentsMembers.regionid#
        </cfquery>
            <cfsavecontent variable="hostCBCEmailMessage">
              <Cfoutput>	
              
                The following CBC Authorization forms have been submitted for the <strong>#qHostParentsMembers.fatherlastname#</strong> family.  Please review and process the CBC's when possible.  
                <br /><br />
                You can process the CBC's here: 
                http://case.exitsapplication.com/nsmg/index.cfm?curdoc=cbc/hosts_cbc&hostID=#client.hostid#
                <br /><br />
                Regards-<Br />
                CASE Support
              </Cfoutput>
                </cfsavecontent>

            <cfinvoke component="cfc.email" method="send_mail">
                
                    <!----<cfinvokeargument name="email_to" value="programManager.pm_email,facilitator.email">---->       
					<cfinvokeargument name="email_to" value="josh@pokytrails.com">     
                    <cfinvokeargument name="email_from" value="hostApp@iseusa.com">
                    <cfinvokeargument name="email_subject" value="CBC Authorization Forms">
                    <cfinvokeargument name="email_message" value="#hostCBCEmailMessage#">
                    
                    <cfloop query="getCBCs">
                   		<cfif getCBCs.currentrow eq 1>
                            <cfinvokeargument name="email_file" value="#dirPath#uploadedfiles/#filePath##fileName#">
                        <cfelse>
                            <cfinvokeargument name="email_file#currentrow#" value="#dirPath#uploadedfiles/#filePath##fileName#">
                        </cfif>
                   </cfloop>
				
                </cfinvoke>	
                <cflocation url="?page=hostLetter">
            <!-------->
            
            <!----Begin Processing---->
            <!----Begin Processing---->
            <!----Begin Processing---->
            <!--- Kill extra output --->
           
                
                <cfsetting requesttimeout="9999">
            
        
                
                <cftry>
                    <!--- param variables --->
                    <cfparam name="hostID" type="numeric" default="#client.hostid#">
            
                    <!--- param FORM variables --->
                    <cfparam name="FORM.submitted" type="numeric" default="1">
                
                    <cfparam name="FORM.memberIDs" default="0">
                    
                   <cfif isDefined('form.motherssn')>
                        <cfparam name="FORM.mothercompanyID" default="1">
                        <cfparam name="FORM.motherSeasonID" default="#form.season#">
                        <cfparam name="FORM.motherdate_authorized" default="#now()#">
                        <cfparam name="FORM.motherIsNoSSN" default="0">
                    <cfelse>
                    	 <cfparam name="FORM.mothercompanyID" default="0">
       					 <cfparam name="FORM.motherSeasonID" default="0">
       					 <cfparam name="FORM.motherdate_authorized" default="">
      					 <cfparam name="FORM.motherIsNoSSN" default="0">
                    </cfif>
                    
                    <cfif isDefined('form.fatherssn')>
                    	<cfparam name="FORM.fathercompanyID" default="1">
                    	<cfparam name="FORM.fatherSeasonID" default="#form.season#">
                    	<cfparam name="FORM.fatherdate_authorized" default="#now()#">
                    	<cfparam name="FORM.fatherIsNoSSN" default="0">
                   	<cfelse>
                    	<cfparam name="FORM.fathercompanyID" default="">
                    	<cfparam name="FORM.fatherSeasonID" default="0">
                    	<cfparam name="FORM.fatherdate_authorized" default="">
                    	<cfparam name="FORM.fatherIsNoSSN" default="0">
                    </cfif> 
                    <cfcatch type="any">
                    
                        <cfscript>
                            // set default values
                            hostID = 0;
                            FORM.submitted = 0;
                        </cfscript>
                        
                    </cfcatch>
                </cftry>  
                
        
           
			
            <cflocation url="?page=hostLetter">
			
		</cfif>	

 </cfif>
<cfquery name="qHostFamilyMembers" datasource="mysql">
select k.name, k.lastname, k.birthdate, k.cbc_form_received, k.childid, k.membertype, k.ssn, k.liveathome
from smg_host_children k
where k.hostid = #client.hostid# 
</cfquery>
<cfquery name="qActiveSeasons" datasource="mysql">
select s.seasonid, s.season 
from smg_seasons s
where active = 1
</cfquery>
<h2>Criminal Background Check</h2>
<!--- Form Errors --->
    <gui:displayFormErrors 
        formErrors="#SESSION.formErrors.GetCollection()#"
        messageType="section"
        />
Due to Department of State Regulations&dagger;, criminal background checks will need to be run on the following persons.  Please provide the following information on each person so that we can complete the background check. <Br />
<Br />

<cfform method="post" action="?page=familyQuestionInterupt">

<cfoutput>
<input type="hidden" name="processCBC"/>
<input type="hidden" name="hostid" value="#client.hostid#" />
<input type="hidden" name="submitted" value="1" />

<h3>Family Members</h3>
<table width=100% cellspacing=0 cellpadding=2 class="border">
   <Tr>
   	<Th>Name</Th><th>Relation</th><th>Date of Birth</th><th>Age</th><th>Social Security</th>
    </Tr>
   <Cfif qHostParentsMembers.recordcount eq 0>
    <tr>
    	<td>Currently, no family members require a backgroundcheck.</td>
    </tr>
    <cfelse>
    <Cfloop query="qHostParentsMembers">
    <cfif fatherfirstname is not ''>
        <tr <Cfif currentrow mod 2> bgcolor="##deeaf3"</cfif>>
            <Td><h3><p class=p_uppercase>#fatherfirstname# #fatherlastname#</h3></Td>
            <Td><h3><p class=p_uppercase>Host Father</h3></Td>
            <Td><h3>#DateFormat(fatherdob, 'mmm d, yyyy')#</h3></Td>
            <td><h3>#DateDiff('yyyy',fatherdob,now())#</h3></td> 
             <input type="hidden" value="#fatherfirstname#" name="fatherfirstname" />
            <td>
            
          	<cfif checkFatherCBC.recordcount eq 0>
            	<cfinput type="text"  name="fatherssn"  mask="999-99-9999" size=12 typeahead="no" showautosuggestloadingicon="true" >
                <cfset submitForm = 1>
      		<cfelse>
            	Request Submitted
            </cfif>
            </td>
      </tr>
    </cfif>
    <cfif motherfirstname is not ''>
        <tr >
            <Td><h3><p class=p_uppercase>#motherfirstname# #motherlastname#</h3></Td>
            <Td><h3><p class=p_uppercase>Host Mother</h3></Td>
            <Td><h3>#DateFormat(motherdob, 'mmm d, yyyy')#</h3></Td>
            <td><h3>#DateDiff('yyyy',motherdob,now())#</h3></td> 
           <input type="hidden" value="#motherfirstname#" name="motherfirstname" />
           
            <td>
            <cfif checkMotherCBC.recordcount eq 0>
            	<cfinput type="text"  name="motherssn"  mask="999-99-9999" size=12 typeahead="no" showautosuggestloadingicon="true" >
                <cfset submitForm = 1>
      		<cfelse>
            	Request Submitted
            </cfif>
            </td>

        </tr>
    </cfif>
    </Cfloop>
    <cfif qHostFamilyMembers.recordcount gt 0>
    <tr>
    	<Td colspan=7><hr width=60% align="center"></Td>
    </tr>
    </cfif>
    <cfset famMembersList =''>
    <Cfloop query="qHostFamilyMembers">
    <Cfif #DateDiff('yyyy',birthdate,now())# gte 18>
		<cfset famMembersList = #ListAppend(famMembersList,#qHostFamilyMembers.childid#)#>
	</Cfif>
        <tr <Cfif currentrow mod 2> bgcolor="##deeaf3"</cfif>>
            <Td><h3><p class=p_uppercase>#name# #lastname#</h3></Td>
            <td><h3><p class=p_uppercase>#membertype#</h3></td>
            <Td><h3>#DateFormat(birthdate, 'mmm d, yyyy')#</h3></Td>
            <td><h3>#DateDiff('yyyy',birthdate,now())#</h3></td> 
			<Cfif #DateDiff('yyyy',birthdate,now())# gte 18 and liveathome is 'yes'>
                
                <td>
                <input type="hidden" name="#qHostFamilyMembers.childid#_name" value="#name#" />
              <Cfif ssn is not ''>
              	Request Submitted
              <cfelse>
                <cfinput type="text" name="#qHostFamilyMembers.childid#_ssn" mask="999-99-9999" size=12 typeahead="no"  showautosuggestloadingicon="true" value="#ssn#">
                <cfset submitForm = 1></td>
              </Cfif>	
            <cfelse>
                <td colspan=2 >Background check is not required for #name#.</td>
            </Cfif> 
        </tr>

    </Cfloop>
    <input type="hidden" name="famList" value="#famMembersList#" />
    </cfif>
   </table>
<h3>Signature(s)</h3>
	<table width=100% cellspacing=0 cellpadding=2 class="border">
   <Tr  bgcolor="##deeaf3">
   	<Th align="center">I/We are submitting this authorization for a criminal background check on the above individuals.  Please use our typed name in place of a signature to initiate the background check process.<br />
    
    </th>
    
    </Tr>
    <tr  bgcolor="##deeaf3">
    
    	<td >
        <table align="center">
 
        

        	<Cfloop query="qHostParentsMembers">
           
            <cfquery name="parentsCBC" datasource="mysql">
                select *
                from smg_documents
                where userid = #client.hostid#
                
            </cfquery>
           	<cfquery name="fatherCBC" dbtype="query">
            select *
            from parentsCBC
            where shortDesc = 'Host Father'
            </cfquery>
           <cfquery name="motherCBC" dbtype="query">
            select *
            from parentsCBC
            where shortDesc = 'Host Mother'
            </cfquery>
			<cfif fatherfirstname is not ''>
            <tr>
                <Td><h3><p class=p_uppercase>#fatherfirstname# #fatherlastname#</h3></Td>
                <Td>
                <cfif checkFatherCBC.recordcount eq 0>
                	<input type="text" name="FatherSig" size=20/></Td>
                <cfelse>
            		CBC Authoriaztion Submitted
            	</cfif>
            </tr>    
            </cfif>
            <cfif motherfirstname is not ''>
            <tr>
                <Td><h3><p class=p_uppercase>#motherfirstname# #motherlastname#</h3></Td>
                <Td>
                <cfif checkMotherCBC.recordcount eq 0>
                	<input type="text" name="MotherSig" size=20/>
                <cfelse>
            		CBC Authoriaztion Submitted
            	</cfif>
                </Td>
            </tr>    
            </cfif>
            </cfloop>
        
            <Cfloop query="qHostFamilyMembers">
          
            <cfquery name="cbcInfo" datasource="mysql">
            select *
            from smg_documents
            where userid = #qHostFamilyMembers.childID#
            </cfquery>
				<Cfif #DateDiff('yyyy',birthdate,now())# gte 18 and liveathome is 'yes'>
                    <tr>
                		<Td><h3><p class=p_uppercase>#name# #lastname#</p></h3></Td><td>
                        <Cfif ssn is not ''>
                        CBC Authoriaztion Submitted
                        <cfelse>
                        <input type="text" name="#qHostFamilyMembers.childid#_sig" />
                        </Cfif>
                        </td>
                    </tr>
                </Cfif>
			</Cfloop>
        	</table>
        </td>
     </tr>
    </table>
</cfoutput>

<p>&nbsp;</p>
<p><Br />
</p>
<p>By providing this information and clicking on submit I do hereby authorize verification of all information in my application for involvement with the Exchange Program from all necessary sources and additionally authorize any duly recognized agent of General Information Services, Inc. to obtain the said records and such disclosures.</p>
<p>Information entered on this Authorization will be used exclusively by General Information Services, Inc. for identification purposes and for the release of information that will be considered in determining any suitability for participation in the Exchange Program. </p>
<p>Upon proper identification and via a request submitted directly to General Information Services, Inc., I have the right to request from General Information Services, Inc. information about the nature and substance of all records on file about me at the time of my request.  This may include the type of information requested as well as those who requested reports from General Information Services, Inc.  within the two-year period preceding my request.</p>
<table border=0 cellpadding=4 cellspacing=0 width=100% class="section">
	<tr>
		<td align="right">
        <!----
        <cfif submitForm eq 0>
        <a href="?page=familyInterests"><img src="../images/buttons/submitBlue.png" border=0 /></a>
        <cfelse>
		---->
        <input name="Submit" type="image" src="../images/buttons/submitBlue.png" border=0>
        <!----
        </cfif>
        ---->
		</td>
	</tr>
</table>
</cfform>
<p><b>As part of our background check, reports from several sources may be obtained.  Reports may include, but not be limited to, criminal history reports, Social Security verifications, address histories, and Sex Offender Registries.  Should any results from the aforementioned reports indicate that driving history records will need to be reviewed during a more comprehensive assessment, an additional authorization and release will be requested at that time.  You have a the right, upon written request, to complete and accurate disclosure of the nature and scope of the background check. 
</b></p>

<h3><u>Department Of State Regulations</u></h3>
<p>&dagger;<strong><a href="http://ecfr.gpoaccess.gov/cgi/t/text/text-idx?c=ecfr&sid=bfef5f6152d538eed70ad639c221a216&rgn=div8&view=text&node=22:1.0.1.7.37.2.1.6&idno=22" target="_blank" class=external>CFR Title 22, Part 62, Subpart B, &sect;62.25 (j)(7)</a></strong><br />
<em> Verify that each member of the host family household 18 years of age and older, as well as any new adult member added to the household, or any member of the host family household who will turn eighteen years of age during the exchange student's stay in that household, has undergone a criminal background check (which must include a search of the Department of Justice's National Sex Offender Public Registry);</em>

<br /><br />
<!---
<h3>Great!  Your done with the fast, simple questions. Now we need to get to know your family a little better.  The next few pages include questions that are key items we use to find kids that will ultimately fit best with your family. </h3>
<br />
<div align="center"><a href="index.cfm?page=familyInterests">Lets get started....</a></div>
---->
